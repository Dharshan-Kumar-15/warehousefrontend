{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { inject } from '@angular/core';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { SpinnerComponent } from '../../../Others/spinner/spinner.component';\nimport { ApiService } from '../../../../Services/ApiService/api.service';\nimport { AuthService } from '../../../../Services/AuthService/auth.service';\nimport { Router, RouterLink } from '@angular/router';\nimport { ToastrService } from 'ngx-toastr';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nconst _forTrack0 = ($index, $item) => $item.product_id;\nconst _forTrack1 = ($index, $item) => $item.product.product_id;\nfunction OrderFormComponent_Conditional_33_For_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", product_r1.product_id)(\"disabled\", product_r1.product_stocks <= 0);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate4(\" \", product_r1.product_id, \" Name: \", product_r1.product_name, \" Price: \", product_r1.product_price, \" (\", product_r1.product_stocks, \" in stock) \");\n  }\n}\nfunction OrderFormComponent_Conditional_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵrepeaterCreate(0, OrderFormComponent_Conditional_33_For_1_Template, 2, 6, \"option\", 30, _forTrack0);\n  }\n  if (rf & 2) {\n    i0.ɵɵrepeater(ctx);\n  }\n}\nfunction OrderFormComponent_Conditional_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtext(1, \"Minimum quantity is 1\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction OrderFormComponent_Conditional_49_For_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 38)(10, \"button\", 39);\n    i0.ɵɵlistener(\"click\", function OrderFormComponent_Conditional_49_For_15_Template_button_click_10_listener() {\n      const ɵ$index_117_r4 = i0.ɵɵrestoreView(_r3).$index;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.removeProduct(ɵ$index_117_r4));\n    });\n    i0.ɵɵtext(11, \" remove \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r6.product.product_name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r6.product.product_price);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r6.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r6.product.product_price * item_r6.quantity);\n  }\n}\nfunction OrderFormComponent_Conditional_49_Conditional_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-spinner\");\n  }\n}\nfunction OrderFormComponent_Conditional_49_Conditional_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"i\", 40);\n    i0.ɵɵtext(1, \"Place Order \");\n  }\n}\nfunction OrderFormComponent_Conditional_49_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"table\", 32)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Product\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Price\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Quantity\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Subtotal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"th\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵrepeaterCreate(14, OrderFormComponent_Conditional_49_For_15_Template, 12, 4, \"tr\", null, _forTrack1);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"tfoot\", 33)(17, \"tr\")(18, \"th\", 34);\n    i0.ɵɵtext(19, \"Total\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"th\", 35);\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(22, \"div\", 36)(23, \"button\", 37);\n    i0.ɵɵlistener(\"click\", function OrderFormComponent_Conditional_49_Template_button_click_23_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.submitOrder());\n    });\n    i0.ɵɵtemplate(24, OrderFormComponent_Conditional_49_Conditional_24_Template, 1, 0, \"app-spinner\")(25, OrderFormComponent_Conditional_49_Conditional_25_Template, 2, 0);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵrepeater(ctx_r4.selectedProducts);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.getTotal(), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.isLoading);\n    i0.ɵɵadvance();\n    i0.ɵɵconditional(ctx_r4.isLoading ? 24 : 25);\n  }\n}\nfunction OrderFormComponent_Conditional_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵtext(1, \" No products added yet. Select products from the left panel to add to your order. \");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let OrderFormComponent = /*#__PURE__*/(() => {\n  class OrderFormComponent {\n    constructor() {\n      this.fb = inject(FormBuilder);\n      this.apiService = inject(ApiService);\n      this.authService = inject(AuthService);\n      this.router = inject(Router);\n      this.toastr = inject(ToastrService);\n      this.orderForm = this.fb.group({\n        productId: [0],\n        quantity: [0, [Validators.min(1)]]\n      });\n      this.products$ = this.apiService.getProducts();\n      this.selectedProducts = [];\n      this.isLoading = false;\n    }\n    addProduct() {\n      const productId = this.orderForm.value.productId ?? 0;\n      const quantity = this.orderForm.value.quantity ?? 0;\n      console.log(\"ID: add:\" + productId);\n      this.products$.subscribe(products => {\n        console.log(\"Available products: \", products);\n        const product = products.find(p => p.product_id === +productId);\n        console.log(\"Selected product \", product);\n        if (product) {\n          if (product.product_stocks < quantity) {\n            this.toastr.warning('Only' + `${product.product_stocks}` + 'items available in stock');\n            return;\n          }\n          const existingItem = this.selectedProducts.find(item => item.product.product_id === productId);\n          if (existingItem) {\n            existingItem.quantity += quantity;\n          } else {\n            this.selectedProducts.push({\n              product,\n              quantity\n            });\n          }\n          this.orderForm.get('quantity')?.reset();\n        } else {\n          console.log(\"error in add product\");\n        }\n      });\n      if (this.orderForm.get('productId')?.invalid || this.orderForm.get('quantity')?.invalid) {\n        return;\n      }\n    }\n    removeProduct(index) {\n      this.selectedProducts.splice(index, 1);\n    }\n    getTotal() {\n      return this.selectedProducts.reduce((sum, item) => sum + item.product.product_price * item.quantity, 0);\n    }\n    submitOrder() {\n      if (this.selectedProducts.length === 0) {\n        this.toastr.warning('Please add at least one product to the order');\n        return;\n      }\n      this.isLoading = true;\n      const userId = this.authService.getUserId();\n      console.log(\"Order form:\" + userId);\n      if (!userId) {\n        this.toastr.error('User not Authenticated');\n        this.isLoading = false;\n        return;\n      }\n      this.apiService.getBuyerByUserId(userId).subscribe({\n        next: buyer => {\n          console.log('buyer Ids', buyer.buyer_id);\n          if (!buyer) {\n            this.toastr.warning('Please complete your profile before placing  an order');\n            this.router.navigate(['/buyer/profile']);\n            this.isLoading = false;\n            return;\n          }\n          const formValue = this.orderForm.value.productId;\n          console.log(\"from order form:\" + formValue);\n          this.apiService.getProductId(formValue).subscribe({\n            next: fullproduct => {\n              const order = {\n                buyer: buyer,\n                items: this.selectedProducts.map(item => ({\n                  product: fullproduct,\n                  quantity: item.quantity,\n                  price: item.product.product_price\n                }))\n              };\n              console.log(\"orders: from order form \", order);\n              this.apiService.createOrder(order).subscribe({\n                next: () => {\n                  this.toastr.success('Order placed successfully!');\n                  this.router.navigate(['/buyer/orders']);\n                },\n                error: err => {\n                  this.toastr.error('Failed to place order');\n                  this.isLoading = false;\n                }\n              });\n            },\n            error: err => {\n              this.toastr.error(err.error?.message || 'Failed to load buyer profile');\n              this.isLoading = false;\n            }\n          });\n        }\n      });\n    }\n    logout() {\n      this.authService.logout();\n    }\n    static {\n      this.ɵfac = function OrderFormComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || OrderFormComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: OrderFormComponent,\n        selectors: [[\"app-order-form\"]],\n        decls: 51,\n        vars: 7,\n        consts: [[1, \"navbar\", \"navbar-expand-lg\", \"navbar-dark\", \"bg-dark\"], [1, \"container\"], [\"routerLink\", \"/buyer/profile\", 1, \"navbar-brand\"], [\"id\", \"navbarNav\", 1, \"collapse\", \"navbar-collapse\"], [1, \"navbar-nav\"], [1, \"nav-item\"], [\"routerLink\", \"/buyer/products\", 1, \"nav-link\", \"active\"], [\"routerLink\", \"/buyer/products\", 1, \"nav-link\", \"text-white\"], [\"id\", \"navbar-item\", 1, \"navbar-nav\"], [1, \"nav-link\", \"btn-primary\", \"btn\", 3, \"click\"], [1, \"container\", \"mt-4\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"col\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"mb-0\"], [1, \"card-body\"], [3, \"formGroup\"], [1, \"mb-3\"], [\"for\", \"productId\", 1, \"form-label\", \"me-2\", \"mt-2\"], [\"formControlName\", \"productId\", \"id\", \"productId\", 1, \"form-select\"], [\"value\", \"\"], [\"for\", \"quantity\", 1, \"form-label\"], [\"type\", \"number\", \"formControlName\", \"quantity\", \"min\", \"1\", \"id\", \"quantity\", 1, \"form-control\"], [1, \"text-danger\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-primary\", 3, \"click\", \"disabled\"], [1, \"bi\", \"bi-plus-circle\", \"me-2\"], [1, \"card\", \"mb-4\"], [1, \"card-header\", \"bg-success\", \"text-white\"], [1, \"alert\", \"alert-info\"], [3, \"value\", \"disabled\"], [1, \"table-responsive\"], [1, \"table\"], [1, \"table-group-divider\"], [\"colspan\", \"3\"], [\"colspan\", \"2\"], [1, \"d-grid\", \"mt-3\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"btn-lg\", 3, \"click\", \"disabled\"], [1, \"text-end\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [1, \"bi\", \"bi-check-circle\", \"me-2\"]],\n        template: function OrderFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"nav\", 0)(1, \"div\", 1)(2, \"a\", 2);\n            i0.ɵɵtext(3, \"Buyer\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 3)(5, \"ul\", 4)(6, \"li\", 5)(7, \"a\", 6);\n            i0.ɵɵtext(8, \"Home\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"li\", 5)(10, \"a\", 7);\n            i0.ɵɵtext(11, \"Products\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(12, \"ul\", 8)(13, \"li\", 5)(14, \"a\", 9);\n            i0.ɵɵlistener(\"click\", function OrderFormComponent_Template_a_click_14_listener() {\n              return ctx.logout();\n            });\n            i0.ɵɵtext(15, \"Logout\");\n            i0.ɵɵelementEnd()()()()();\n            i0.ɵɵelementStart(16, \"div\", 10)(17, \"h2\");\n            i0.ɵɵtext(18, \"Create New Order\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"div\", 11)(20, \"div\", 12)(21, \"div\", 13)(22, \"div\", 14)(23, \"h3\", 15);\n            i0.ɵɵtext(24, \"Add Products\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(25, \"div\", 16)(26, \"form\", 17)(27, \"div\", 18)(28, \"label\", 19);\n            i0.ɵɵtext(29, \"Select Product\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(30, \"select\", 20)(31, \"option\", 21);\n            i0.ɵɵtext(32, \"Choose a Product\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(33, OrderFormComponent_Conditional_33_Template, 2, 0);\n            i0.ɵɵpipe(34, \"async\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(35, \"div\", 18)(36, \"label\", 22);\n            i0.ɵɵtext(37, \"Quantity\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(38, \"input\", 23);\n            i0.ɵɵtemplate(39, OrderFormComponent_Conditional_39_Template, 2, 0, \"div\", 24);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(40, \"button\", 25);\n            i0.ɵɵlistener(\"click\", function OrderFormComponent_Template_button_click_40_listener() {\n              return ctx.addProduct();\n            });\n            i0.ɵɵelement(41, \"i\", 26);\n            i0.ɵɵtext(42, \"Add to Order \");\n            i0.ɵɵelementEnd()()()()();\n            i0.ɵɵelementStart(43, \"div\", 12)(44, \"div\", 27)(45, \"div\", 28)(46, \"h3\");\n            i0.ɵɵtext(47, \"Order Summary\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(48, \"div\", 16);\n            i0.ɵɵtemplate(49, OrderFormComponent_Conditional_49_Template, 26, 3)(50, OrderFormComponent_Conditional_50_Template, 2, 0, \"div\", 29);\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            let tmp_1_0;\n            let tmp_2_0;\n            let tmp_3_0;\n            i0.ɵɵadvance(26);\n            i0.ɵɵproperty(\"formGroup\", ctx.orderForm);\n            i0.ɵɵadvance(7);\n            i0.ɵɵconditional((tmp_1_0 = i0.ɵɵpipeBind1(34, 5, ctx.products$)) ? 33 : -1, tmp_1_0);\n            i0.ɵɵadvance(6);\n            i0.ɵɵconditional(((tmp_2_0 = ctx.orderForm.get(\"quantity\")) == null ? null : tmp_2_0.invalid) && ((tmp_2_0 = ctx.orderForm.get(\"quantity\")) == null ? null : tmp_2_0.touched) ? 39 : -1);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", !((tmp_3_0 = ctx.orderForm.get(\"productId\")) == null ? null : tmp_3_0.value) || ((tmp_3_0 = ctx.orderForm.get(\"quantity\")) == null ? null : tmp_3_0.invalid));\n            i0.ɵɵadvance(9);\n            i0.ɵɵconditional(ctx.selectedProducts.length > 0 ? 49 : 50);\n          }\n        },\n        dependencies: [CommonModule, i1.AsyncPipe, ReactiveFormsModule, i2.ɵNgNoValidate, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.SelectControlValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.MinValidator, i2.FormGroupDirective, i2.FormControlName, SpinnerComponent, RouterLink],\n        encapsulation: 2\n      });\n    }\n  }\n  return OrderFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}