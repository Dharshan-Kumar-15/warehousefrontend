{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { inject } from '@angular/core';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { SpinnerComponent } from '../../../Others/spinner/spinner.component';\nimport { ApiService } from '../../../../Services/ApiService/api.service';\nimport { RouterLink } from '@angular/router';\nimport { AuthService } from '../../../../Services/AuthService/auth.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"ngx-toastr\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ProductFormComponent_div_17_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \"Product Name is Required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductFormComponent_div_17_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \"Product Price is Required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductFormComponent_div_17_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1, \"Product Stock is Required \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductFormComponent_div_17_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"label\", 31);\n    i0.ɵɵtext(2, \"Image Preview\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"img\", 32);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", ctx_r2.imagePreview, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ProductFormComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"form\", 15);\n    i0.ɵɵlistener(\"ngSubmit\", function ProductFormComponent_div_17_Template_form_ngSubmit_3_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.onSubmit());\n    });\n    i0.ɵɵelementStart(4, \"div\", 16)(5, \"label\", 17);\n    i0.ɵɵtext(6, \"Product Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"input\", 18);\n    i0.ɵɵtemplate(8, ProductFormComponent_div_17_div_8_Template, 2, 0, \"div\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 16)(10, \"label\", 20);\n    i0.ɵɵtext(11, \"Product Description\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"textarea\", 21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 16)(14, \"label\", 22);\n    i0.ɵɵtext(15, \"Product Price\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"input\", 23);\n    i0.ɵɵtemplate(17, ProductFormComponent_div_17_div_17_Template, 2, 0, \"div\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\", 16)(19, \"label\", 24);\n    i0.ɵɵtext(20, \"Product Stock\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"input\", 25);\n    i0.ɵɵtemplate(22, ProductFormComponent_div_17_div_22_Template, 2, 0, \"div\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 16)(24, \"label\", 26);\n    i0.ɵɵtext(25, \"Product Image\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"input\", 27);\n    i0.ɵɵlistener(\"change\", function ProductFormComponent_div_17_Template_input_change_26_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.onFileSelected($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(27, ProductFormComponent_div_17_div_27_Template, 4, 1, \"div\", 28);\n    i0.ɵɵelementStart(28, \"button\", 29);\n    i0.ɵɵtext(29);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    let tmp_4_0;\n    let tmp_5_0;\n    let tmp_6_0;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.isEdit ? \"Update Product\" : \"Create Product\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.productForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_4_0 = ctx_r2.productForm.get(\"product_name\")) == null ? null : tmp_4_0.touched) && ((tmp_4_0 = ctx_r2.productForm.get(\"product_name\")) == null ? null : tmp_4_0.invalid));\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_5_0 = ctx_r2.productForm.get(\"product_price\")) == null ? null : tmp_5_0.touched) && ((tmp_5_0 = ctx_r2.productForm.get(\"product_price\")) == null ? null : tmp_5_0.invalid));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_6_0 = ctx_r2.productForm.get(\"product_stocks\")) == null ? null : tmp_6_0.touched) && ((tmp_6_0 = ctx_r2.productForm.get(\"product_stocks\")) == null ? null : tmp_6_0.invalid));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.imagePreview);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r2.productForm.invalid || ctx_r2.isLoading);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.isEdit ? \"Update\" : \"Create\", \" Product\");\n  }\n}\nfunction ProductFormComponent_ng_template_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-spinner\");\n  }\n}\nexport let ProductFormComponent = /*#__PURE__*/(() => {\n  class ProductFormComponent {\n    constructor(route, router, toastr) {\n      this.route = route;\n      this.router = router;\n      this.toastr = toastr;\n      this.fb = inject(FormBuilder);\n      this.apiService = inject(ApiService);\n      this.authService = inject(AuthService);\n      this.productForm = this.fb.group({\n        product_name: ['', Validators.required],\n        product_Desc: [''],\n        product_price: [0, [Validators.required, Validators.minLength(0)]],\n        product_stocks: [0, [Validators.required, Validators.minLength(0)]]\n      });\n      this.isEdit = false;\n      this.selectedFile = null;\n      this.imagePreview = null;\n      this.isLoading = false;\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        if (params['id']) {\n          this.isEdit = true;\n          this.productId = +params['id'];\n          this.loadProduct(this.productId);\n        }\n      });\n    }\n    //LoadProduct\n    loadProduct(id) {\n      this.isLoading = true;\n      this.apiService.getProductId(id).subscribe({\n        next: product => {\n          this.productForm.patchValue({\n            product_name: product.product_name,\n            product_Desc: product.product_Desc,\n            product_price: product.product_price,\n            product_stocks: product.product_stocks\n          });\n          this.isLoading = false;\n        },\n        error: err => {\n          this.toastr.error(err.error?.message || 'Failed to load  product');\n          this.isLoading = false;\n        }\n      });\n    }\n    onFileSelected(event) {\n      const input = event.target;\n      if (input.files && input.files.length > 0) {\n        this.selectedFile = input.files[0];\n        // preview image\n        const reader = new FileReader();\n        reader.onload = () => {\n          this.imagePreview = reader.result;\n        };\n        reader.readAsDataURL(this.selectedFile);\n      }\n    }\n    onSubmit() {\n      this.isLoading = true;\n      const formValue = this.productForm.value;\n      const productData = {\n        product_name: formValue.product_name ?? '',\n        product_Desc: formValue.product_Desc ?? '',\n        product_price: formValue.product_price ?? 0,\n        product_stocks: formValue.product_stocks ?? 0\n      };\n      if (this.isEdit && this.productId) {\n        if (this.selectedFile) {\n          this.apiService.updateProduct(this.productId, productData, this.selectedFile).subscribe({\n            // this.apiService.updateProduct(this.productId,productData).subscribe({\n            next: () => {\n              this.toastr.success('Product updated successfully');\n              this.router.navigate(['admin/products']);\n              this.isLoading = false;\n            },\n            error: err => {\n              this.toastr.error('Product update failed');\n              console.log('please select file');\n              this.isLoading = false;\n            }\n          });\n        } else {\n          this.toastr.error('Please select a file before submitting');\n          console.log('please select file');\n          this.isLoading = false;\n        }\n      } else {\n        if (this.selectedFile) {\n          console.log(this.selectedFile.name);\n          this.apiService.createProduct(productData, this.selectedFile).subscribe({\n            //  this.apiService.createProduct(productData).subscribe({\n            next: () => {\n              console.log('success');\n              this.toastr.success('Product Created Succesfully');\n              this.router.navigate(['admin/products']);\n            },\n            error: err => {\n              debugger;\n              this.toastr.error(err.error?.message || 'Failed to Create Product');\n              console.log('please select file before creating from error');\n              this.isLoading = false;\n            }\n          });\n        } else {\n          this.toastr.error('Please select a file before creating');\n          console.log('please select file before creating from else');\n          this.isLoading = false;\n        }\n      }\n      if (this.productForm.invalid) {\n        return;\n      }\n    }\n    logout() {\n      this.authService.logout();\n    }\n    static {\n      this.ɵfac = function ProductFormComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProductFormComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ToastrService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductFormComponent,\n        selectors: [[\"app-product-form\"]],\n        decls: 20,\n        vars: 2,\n        consts: [[\"loading\", \"\"], [1, \"navbar\", \"navbar-expand-lg\", \"bg-warning\"], [1, \"container-fluid\"], [\"href\", \"#\", 1, \"navbar-brand\"], [\"type\", \"button\", \"data-bs-toggle\", \"collapse\", \"data-bs-target\", \"#navbarNav\", \"aria-controls\", \"navbarNav\", \"aria-expanded\", \"false\", \"aria-label\", \"Toggle navigation\", 1, \"navbar-toggler\"], [1, \"navbar-toggler-icon\"], [\"id\", \"navbarNav\", 1, \"collapse\", \"navbar-collapse\"], [1, \"navbar-nav\"], [1, \"nav-item\"], [\"routerLink\", \"/admin/products\", 1, \"nav-link\", \"active\"], [\"routerLink\", \"/admin/products\", 1, \"nav-link\", \"text-white\"], [1, \"d-flex\", \"justify-content-end\", \"align-items-end\", \"me-5\"], [1, \"btn\", \"btn-danger\", 2, \"cursor\", \"pointer\", 3, \"click\"], [\"class\", \"container mt-4\", 4, \"ngIf\", \"ngIfElse\"], [1, \"container\", \"mt-4\"], [\"enctype\", \"multipart/form-data\", 3, \"ngSubmit\", \"formGroup\"], [1, \"mb-3\"], [\"for\", \"product_name\", 1, \"form-label\"], [\"type\", \"text\", \"formControlName\", \"product_name\", \"placeholder\", \"Enter Product Name\", \"id\", \"product_name\", 1, \"form-control\"], [\"class\", \"text-danger\", 4, \"ngIf\"], [\"for\", \"product_Desc\", 1, \"form-label\"], [\"type\", \"text\", \"formControlName\", \"product_Desc\", \"placeholder\", \"Enter Product Description\", \"id\", \"product_Desc\", 1, \"form-control\"], [\"for\", \"product_price\", 1, \"form-label\"], [\"type\", \"number\", \"formControlName\", \"product_price\", \"placeholder\", \"Enter Product Price\", \"id\", \"product_price\", 1, \"form-control\"], [\"for\", \"product_stocks\", 1, \"form-label\"], [\"type\", \"number\", \"formControlName\", \"product_stocks\", \"placeholder\", \"Enter Product Stock\", \"id\", \"product_stocks\", 1, \"form-control\"], [\"for\", \"image\", 1, \"form-label\"], [\"type\", \"file\", \"id\", \"image\", 1, \"form-control\", 3, \"change\"], [\"class\", \"mb-3\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"text-danger\"], [\"for\", \"\", 1, \"form-label\"], [\"alt\", \"preview\", \"width\", \"200\", 1, \"img-thumbnail\", 3, \"src\"]],\n        template: function ProductFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"nav\", 1)(1, \"div\", 2)(2, \"a\", 3);\n            i0.ɵɵtext(3, \"Admin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"button\", 4);\n            i0.ɵɵelement(5, \"span\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"div\", 6)(7, \"ul\", 7)(8, \"li\", 8)(9, \"a\", 9);\n            i0.ɵɵtext(10, \"Home\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"li\", 8)(12, \"a\", 10);\n            i0.ɵɵtext(13, \" Products List\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(14, \"div\", 11)(15, \"a\", 12);\n            i0.ɵɵlistener(\"click\", function ProductFormComponent_Template_a_click_15_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.logout());\n            });\n            i0.ɵɵtext(16, \"Logout\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(17, ProductFormComponent_div_17_Template, 30, 8, \"div\", 13)(18, ProductFormComponent_ng_template_18_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n          }\n          if (rf & 2) {\n            const loading_r4 = i0.ɵɵreference(19);\n            i0.ɵɵadvance(17);\n            i0.ɵɵproperty(\"ngIf\", !ctx.isLoading)(\"ngIfElse\", loading_r4);\n          }\n        },\n        dependencies: [CommonModule, i3.NgIf, ReactiveFormsModule, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.FormControlName, SpinnerComponent, RouterLink],\n        encapsulation: 2\n      });\n    }\n  }\n  return ProductFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}